{% extends "base.html" %}
{% block title %}Matched Scholarships ‚Äì ScholarMatch{% endblock %}
{% block content %}

<h1 class="text-3xl font-bold text-[#3B2632] mb-6 text-center">üéì Scholarships Matching Your Profile</h1>

<!-- Filters -->
<form method="GET" class="grid md:grid-cols-4 gap-4 mb-8">
  <input name="q" value="{{ request.args.get('q','') }}" placeholder="Search by name"
         class="w-full p-3 border rounded-lg">
  <input name="income_max" value="{{ request.args.get('income_max','') }}" placeholder="Max Income (‚Çπ)"
         class="w-full p-3 border rounded-lg" />
  <input name="amount_min" value="{{ request.args.get('amount_min','') }}" placeholder="Min Amount (‚Çπ)"
         class="w-full p-3 border rounded-lg" />
  <button class="bg-[#3B2632] text-white rounded-lg px-4 py-2 hover:bg-[#5c3b4d] transition">Filter</button>
</form>

<!-- Cards -->
<div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
  {% for s in scholarships %}
    <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition border 
                {% if s.id in saved_ids %}border-green-400{% elif s.id in applied_ids %}border-gray-400{% else %}border-[#EBDDE2]{% endif %} relative hover:-translate-y-1 hover:shadow-lg">

      {% if s.is_closing_soon and s.id not in applied_ids %}
        <span class="absolute top-2 right-2 bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded">‚è∞ Closing Soon</span>
      {% endif %}

      <h2 class="text-xl font-bold text-[#3B2632] mb-1">{{ s.name }}</h2>
      <p><strong>Field:</strong> {{ s.get("field","Any") }}</p>
      <p><strong>Min Percentage:</strong> {{ s.get("min_percentage","0") }}%</p>
      {% if s.amount %}<p><strong>Amount:</strong> <span class="text-green-700">{{ s.amount }}</span></p>{% endif %}
      {% if s.deadline %}<p><strong>Deadline:</strong> {{ s.deadline }}</p>{% endif %}
      <p><strong>Category:</strong> {{ s.category }}</p>
      <p><strong>Education:</strong> {{ s.education }}</p>
      <p><strong>State:</strong> {{ s.state }}</p>

      <div class="mt-4 flex gap-2">
        <!-- Save Button -->
        {% if s.id not in saved_ids %}
        <form method="POST" action="{{ url_for('save_scholarship') }}" class="flex-1">
            <input type="hidden" name="scholarship_id" value="{{ s.id }}">
            <button class="px-4 py-2 border rounded-lg hover:bg-gray-50 w-full">Save</button>
        </form>
        {% else %}
            <button class="px-4 py-2 border rounded-lg opacity-60 cursor-not-allowed flex-1">Saved</button>
        {% endif %}

        <!-- Apply Button -->
        {% if s.id not in applied_ids %}
        <form method="POST" action="{{ url_for('apply_scholarship') }}" class="flex-1">
            <input type="hidden" name="scholarship_id" value="{{ s.id }}">
            <button class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg w-full transition">Apply</button>
        </form>
        {% else %}
            <button class="px-4 py-2 bg-gray-400 text-white rounded-lg opacity-60 cursor-not-allowed flex-1">Applied</button>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>

{% if not scholarships %}
  <p class="text-center text-red-600 mt-10 text-lg font-semibold">No matching scholarships found.</p>
{% endif %}

{% endblock %}
